<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Controle de Gastos - Python</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CDN só para deixar bonitinho rapidamente -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark bg-dark mb-4">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">
          Controle de Gastos - Gestão Financeira Inteligente (Python)
        </span>
      </div>
    </nav>

    <div class="container mb-4">
      <div class="row g-3">
        <!-- Resumo -->
        <div class="col-md-4">
          <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <strong>Resumo do mês</strong>
              <form method="get" class="d-flex">
                <select name="month" class="form-select form-select-sm me-2">
                  {% for m in months %}
                  <option value="{{ m }}" {% if m == current_month %}selected{% endif %}>
                    {{ m }}
                  </option>
                  {% endfor %}
                </select>
                <button class="btn btn-sm btn-primary" type="submit">Trocar</button>
              </form>
            </div>
            <div class="card-body">
              <p><strong>Mês:</strong> {{ summary.month_key }}</p>
              <p class="text-success">
                <strong>Renda total:</strong> R$ {{ "%.2f"|format(summary.total_income) }}
              </p>
              <p class="text-danger">
                <strong>Gastos totais:</strong> R$ {{ "%.2f"|format(summary.total_expenses) }}
              </p>
              <p class="{% if summary.balance >= 0 %}text-success{% else %}text-danger{% endif %}">
                <strong>Saldo:</strong> R$ {{ "%.2f"|format(summary.balance) }}
              </p>
            </div>
          </div>

          <!-- Totais por categoria -->
          <div class="card shadow-sm mt-3">
            <div class="card-header">
              <strong>Gastos por categoria</strong>
            </div>
            <div class="card-body">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Categoria</th>
                    <th class="text-end">Total (R$)</th>
                  </tr>
                </thead>
                <tbody>
                  {% for cat, val in summary.category_totals.items() %}
                  <tr>
                    <td>{{ cat }}</td>
                    <td class="text-end">{{ "%.2f"|format(val) }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Formulário e lista -->
        <div class="col-md-8">
          <!-- Formulário -->
          <div class="card shadow-sm mb-3">
            <div class="card-header">
              <strong>Novo lançamento</strong>
            </div>
            <div class="card-body">
              <form method="post" action="{{ url_for('add_entry') }}" class="row g-2">
                <div class="col-md-3">
                  <label class="form-label">Tipo</label>
                  <select name="type" class="form-select" required>
                    <option value="income">Renda</option>
                    <option value="expense">Despesa</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Categoria (para despesa)</label>
                  <select name="category" class="form-select">
                    <option value="">-- selecione --</option>
                    {% for c in categories %}
                    <option value="{{ c }}">{{ c }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Valor (R$)</label>
                  <input
                    type="text"
                    name="value"
                    class="form-control"
                    placeholder="0,00"
                    required
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Data</label>
                  <input type="date" name="date" class="form-control" />
                </div>
                <div class="col-12">
                  <label class="form-label">Descrição / Origem</label>
                  <input
                    type="text"
                    name="description"
                    class="form-control"
                    placeholder="Ex: Salário, Supermercado, Recarga..."
                  />
                </div>
                <div class="col-12 text-end mt-2">
                  <button type="submit" class="btn btn-success">
                    Salvar lançamento
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Lista de lançamentos -->
          <div class="card shadow-sm">
            <div class="card-header">
              <strong>Lançamentos</strong>
            </div>
            <div class="card-body">
              <table class="table table-striped table-hover table-sm">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Tipo</th>
                    <th>Categoria</th>
                    <th>Descrição</th>
                    <th class="text-end">Valor (R$)</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {% for e in entries %}
                  <tr>
                    <td>{{ e.date }}</td>
                    <td>
                      {% if e.type == 'income' %}
                      <span class="badge bg-success">Renda</span>
                      {% else %}
                      <span class="badge bg-danger">Despesa</span>
                      {% endif %}
                    </td>
                    <td>{{ e.category or '-' }}</td>
                    <td>{{ e.source }}</td>
                    <td class="text-end">{{ "%.2f"|format(e.value) }}</td>
                    <td class="text-end">
                      <form
                        method="post"
                        action="{{ url_for('delete_entry', entry_id=e.id) }}"
                        onsubmit="return confirm('Excluir este lançamento?');"
                      >
                        <button class="btn btn-sm btn-outline-danger">
                          Excluir
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="6" class="text-center text-muted">
                      Nenhum lançamento cadastrado ainda.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
